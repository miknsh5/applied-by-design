"use strict";angular.module("appliedByDesignApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/services",{templateUrl:"views/services.html",controller:"ServicesCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/blog",{templateUrl:"views/blog/index.html"}).when("/routemap",{templateUrl:"views/routemap.html",controller:"RoutemapCtrl",resolve:{loadedState:function(a,b,c){var d=b.defer(),e=["airplanes","cityPairs","flights","costcurves","market","services","airports"];return c(function(){for(var a=0,b=0;b<e.length;b++)"undefined"==typeof e[b]&&(a+=1);0!==a?d.resolve([]):d.resolve(a)},500),d.promise}}}).otherwise({redirectTo:"/"})}]),angular.module("appliedByDesignApp").controller("MainCtrl",function(){screen.width>1e3&&skrollr.init({forceHeight:!1,smoothScrolling:!0}),$("#nav-arrow-1").click(function(){$.scrollTo("#strategy-anchor",{duration:"medium"})}),$("#nav-arrow-2").click(function(){$.scrollTo("#design-anchor",{duration:"medium"})}),$("#nav-arrow-3").click(function(){$.scrollTo("#development-anchor",{duration:"medium"})}),$("#nav-arrow-4").click(function(){$.scrollTo("#contact-anchor",{duration:"medium"})});var a;(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/BlackBerry/))&&(a=!0)}),angular.module("appliedByDesignApp").controller("AboutCtrl",["$scope",function(a){a.test="hello",screen.width>1e3&&skrollr.init({forceHeight:!1}),$("#nav-arrow-1").click(function(){$.scrollTo("#bio-anchor-1",{duration:"medium"})}),$("#nav-arrow-2").click(function(){$.scrollTo("#bio-anchor-2",{duration:"medium"})}),$("#nav-arrow-4").click(function(){$.scrollTo("#contact-anchor",{duration:"medium"})})}]),angular.module("appliedByDesignApp").controller("ServicesCtrl",["$scope",function(a){a.test="hello",screen.width>1e3&&skrollr.init({forceHeight:!1}),$("#nav-arrow-1").click(function(){$.scrollTo("#strategy-anchor",{duration:"medium"})}),$("#nav-arrow-2").click(function(){$.scrollTo("#design-anchor",{duration:"medium"})}),$("#nav-arrow-3").click(function(){$.scrollTo("#development-anchor",{duration:"medium"})}),$("#nav-arrow-4").click(function(){$.scrollTo("#contact-anchor",{duration:"medium"})})}]),angular.module("appliedByDesignApp").controller("ContactCtrl",["$scope",function(a){a.test="hello"}]),angular.module("appliedByDesignApp").controller("RoutemapCtrl",["$scope","reportBuilder","navService","financialReports",function(a,b,c,d){a.mapWidth=1800,a.mapHeight=1200,a.equipment=b.generateEquipment(),b.buildRoutes(),b.buildFinancialReport(!0,!1),a.toggleModel=function(e){a.equipment=c.toggleEquipment(e),a.routeReport=b.buildRoutes(),d.runReport("active")},a.showPanel=function(){return c.showPanel},a.togglePanelState=c.togglePanel,a.toggleEquipPanel=c.toggleEquipPanel,a.toggleReport=function(){a.showReport=c.toggleReportPanel()},a.activeTab=c.activeTab,a.selectTab=function(b){a.activeTab=c.selectPanelTab(b)},a.$watch(function(){return c.getActiveTab()},function(b){a.activeTab=b}),a.panelStyle=function(){var a=-250,b=c.showPanel?0:a;return{bottom:b+"px"}},a.equipPanelStyle=function(){var a=-200,b=c.showEquipPanel?0:a;return{top:b+"px"}},a.reportStyle=function(){var b=-1200,c=a.showReport?65:b;return{top:c+"px"}}}]),angular.module("appliedByDesignApp").factory("fleetModel",["$http",function($http){var airplanes,cityPairs,flights,costCurves,market,services,airports;return{getAirplanes:function(){$http({method:"GET",url:"images/airplanes.json"}).success(function(a){airplanes=a}).error(function(){})}(),getCityPairs:function(){$http({method:"GET",url:"images/cityPairs.json"}).success(function(a){cityPairs=a}).error(function(){})}(),getFlights:function(){$http({method:"GET",url:"images/flights.json"}).success(function(a){flights=a}).error(function(){})}(),getCostCurves:function(){$http({method:"GET",url:"images/costcurves.json"}).success(function(a){costCurves=a}).error(function(){})}(),getMarket:function(){$http({method:"GET",url:"images/market.json"}).success(function(a){market=a}).error(function(){})}(),getServices:function(){$http({method:"GET",url:"images/services.json"}).success(function(a){services=a}).error(function(){})}(),getAirports:function(){$http({method:"GET",url:"images/airports.json"}).success(function(a){airports=a}).error(function(){})}(),getData:function(name){return eval(name)}}}]),angular.module("appliedByDesignApp").factory("navService",function(){var a={};return a.showPanel=!0,a.showEquipPanel=!0,a.showReport=!1,a.activeTab=1,a.equipment=[],a.activeFleetModel=0,a.activeYear=0,a.activeMetricName="Crew",a.servicesInQueue=!1,a.togglePanel=function(){return a.showPanel=!a.showPanel,a.showPanel},a.toggleEquipPanel=function(){return a.showEquipPanel=!a.showEquipPanel,a.showEquipPanel},a.toggleReportPanel=function(){return a.showReport=!a.showReport,a.showReport},a.selectPanelTab=function(b){return a.activeTab=b,a.activeTab},a.getActiveTab=function(){return a.activeTab},a.toggleEquipment=function(b){return a.equipment[b].active=!a.equipment[b].active,a.equipment},a.selectFleetModel=function(b){return a.activeFleetModel=b,a.activeFleetModel},a.toggleFleetService=function(b){var c=a.equipment[a.activeFleetModel].services[b].val;return a.equipment[a.activeFleetModel].services[b].val=!c,a.servicesInQueue=!0,a.equipment},a}),angular.module("appliedByDesignApp").controller("FleetPanelCtrl",["$scope","navService",function(a,b){a.activeFleetModel=b.activeFleetModel,a.fleet=b.equipment,a.fleetServices=a.fleet[a.activeFleetModel].details,a.selectModel=function(c){a.activeFleetModel=b.selectFleetModel(c),a.fleetServices=a.fleet[a.activeFleetModel].details},a.toggleService=function(c){a.fleet=b.toggleFleetService(c)}}]),angular.module("appliedByDesignApp").controller("FinancialPanelCtrl",["$scope","financialReports","navService",function(a,b,c){a.fiscalYears=b.getYears(),a.activeYearId=c.activeYear,a.baseFinancialData=function(){return b.getReport("base")[c.activeYear]},a.activeFinancialData=function(){return b.getReport("active")[c.activeYear]},a.chartData=function(){return a.activeFinancialData()[c.activeMetricName].data},a.activeReportName=function(){return c.activeMetricName},a.selectReport=function(a){c.activeMetricName=a},a.selectYear=function(b){c.activeYear=b,a.activeYearId=b},a.getActiveRecord=function(b){return _.findWhere(a.activeFinancialData().data,{name:b})}}]),angular.module("appliedByDesignApp").controller("OperationsPanelCtrl",["$scope","navService","routeService",function(a,b,c){a.chartWidth=175,a.chartHeight=175,c.runRouteReport(),a.activeRouteReport=function(){return c.activeRoute[b.activeYear]},a.dotw=function(){return c.frequencies},a.selectDay=function(a){c.setActiveDay(a)},a.selectDay(0)}]),angular.module("appliedByDesignApp").factory("reportBuilder",["fleetModel","navService","financialReports",function(fleetModel,navService,financialReports){function getUniqueAirports(){for(var a=fleetModel.getData("flights"),b=fleetModel.getData("airports"),c=[],d=0;d<a.length;d++)c.push(a[d].NonDirectional);for(var e=_.uniq(c),f=[],g=0;g<e.length;g++)f.push(e[g].slice(0,3)),f.push(e[g].slice(3,6));for(var h=_.uniq(f),i=[],j=0;j<h.length;j++)i[j]={Code:h[j],Latitide:_.findWhere(b,{Code:h[j]}).Latitude,Longitude:_.findWhere(b,{Code:h[j]}).Longitude};return i}function gcDistance(a){var b=fleetModel.getData("airports"),c=a.slice(0,3),d=a.slice(3,6),e=_.findWhere(b,{Code:c}).Latitude,f=_.findWhere(b,{Code:c}).Longitude,g=_.findWhere(b,{Code:d}).Latitude,h=_.findWhere(b,{Code:d}).Longitude,i=3963.1676,j=e*Math.PI/180,k=f*Math.PI/180,l=g*Math.PI/180,m=h*Math.PI/180,n=m-k,o=Math.acos(Math.sin(j)*Math.sin(l)+Math.cos(j)*Math.cos(l)*Math.cos(n));return 0>o&&(o+=Math.PI),o*=i}var routeReport;return{getReport:function(name){return eval(name)},getRouteNameFromId:function(a){return routeReport[a].NonDirectional},buildFinancialReport:function(a){var b,c,d,e,f,g,h,i,j,k,l=fleetModel.getData("flights"),m=fleetModel.getData("airplanes"),n=fleetModel.getData("market"),o=fleetModel.getData("services"),p=fleetModel.getData("costCurves"),q=navService.equipment,r=this.allRoutes(),s=2013,t=52,u=[],v=[],w={};e=a?n.forecast.years:1;for(var x=0;e>x;x++){b=0,c={},d={RPM:0,ASK:0,PAX:0,Seats:0,"Weeky Freq.":0},f=s+x,v=[];for(var y=0;y<l.length;y++){w.freq=l[y].Frequency,g=_.findWhere(m,{Equipment:l[y].Equipment}).Capacity,w.lf=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).LF*Math.pow(1+n.growth.demand,x),w.pax=w.lf*g,w.bt=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Duration,w.stagelen=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Distance,h=jQuery.extend(!0,{},_.findWhere(p,{Size:_.findWhere(m,{Equipment:l[y].Equipment}).Size}).Coefficients),i=w.pax*w.stagelen,k=_.findWhere(q,{code:l[y].Equipment}).services,j=n.rates.fuel*Math.pow(1+n.growth.fuel,x),w.fare=(n.rates.Coefficients.Revenue.A*Math.pow(w.stagelen,2)+n.rates.Coefficients.Revenue.B*w.stagelen+n.rates.Coefficients.Revenue.C)*Math.pow(1+n.growth.fare,x),w.Revenue=t*w.freq*w.pax*w.fare,w.Flight=l[y].FltNumber,w.Equipment=l[y].Equipment,w.NonDirectional=l[y].NonDirectional,w.oCity=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Ocity,w.oState=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Ostate,w.oCountry=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Ocountry,w.oName=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Oname,w.dCity=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Dcity,w.dState=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Dstate,w.dCountry=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Dcountry,w.oIata=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Oiata,w.dIata=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Diata,w.dName=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Dname,w.Distance=_.findWhere(r,{NonDirectional:l[y].NonDirectional}).Distance,w.monday=+l[y].Monday,w.tuesday=+l[y].Tuesday,w.wednesday=+l[y].Wednesday,w.thursday=+l[y].Thursday,w.friday=+l[y].Friday,w.saturday=+l[y].Saturday,w.sunday=+l[y].Sunday;for(var z=0;z<k.length;z++){var A=k[z].name;if(k[z].val)for(var B in o[A])for(var C in o[A][B])h[B][C]=h[B][C]*o[A][B][C]}var D=0;for(var E in h)void 0===c[E]&&(c[E]=0),w[E]="Fuel"===E?t*w.freq*(h[E].A*Math.pow(i,2)+h[E].B*i+h[E].C)*j:t*w.freq*(h[E].A*Math.pow(w.bt,2)+h[E].B*w.bt+h[E].C)*Math.pow(1+n.growth.costs,x),D+=w[E];w.RPM=i*w.freq*t,w.Seats=g*w.freq*t,w.ASK=g*w.freq*w.stagelen*t,w.PAX=w.pax*w.freq*t,w.Freq=w.freq*t,w.Year=f,v[y]=w,w={}}u[x]={fleetReport:jQuery.extend(!0,{},v)}}0===financialReports.base.length&&(financialReports.setFlightFinancials("base",u),financialReports.runReport("base")),financialReports.setFlightFinancials("active",u),financialReports.runReport("active")},generateEquipment:function(){for(var a,b,c,d=fleetModel.getData("flights"),e=fleetModel.getData("airplanes"),f=_.uniq(_.pluck(d,"Equipment")),g=[],h=0;h<f.length;h++){b=f[h],c=_.find(e,function(a){return a.Equipment===b}),g[h]={name:c.Name,code:b,active:!0},g[h].details=[{name:"Aircraft Name",value:c.Name},{name:"OAG Code",value:b},{name:"Count",value:c.Count},{name:"Capacity",value:c.Capacity},{name:"Cabins",value:c.Cabins}],a=c.Services,g[h].services=[];for(var i in a)g[h].services.push({name:i,val:a[i]})}return navService.equipment=g,g},findArray:function(inputArray,searchCrit,key){for(var critReturn=[],outputArray=[],crit=0;crit<searchCrit.length;crit++)if(critReturn=eval("_.where(inputArray,{"+key+':"'+searchCrit[crit]+'"})'),0===crit)outputArray=critReturn;else for(var j in critReturn)outputArray.push(critReturn[j]);return outputArray},clearReport:function(){routeReport=[]},addFlight:function(a,b,c,d,e){for(var f=0,g=0;g<e.length;g++)e[g]&&f++;var h;h=c>b?b+c:c+b;var i={FltNumber:a,OD:b+"-"+c,NonDirectional:h,Depart:"00:00:00 AM",Arrive:"00:00:00 AM",Equipment:d,Stops:0,Overnight:!1,Partner:!1,Monday:e[0],Tuesday:e[1],Wednesday:e[2],Thursday:e[3],Friday:e[4],Saturday:e[5],Sunday:e[6],Frequency:f};return i},greatAirportRoutes:function(a){for(var b=[],c=this.buildRoutes(),d=0;d<c.length;d++)(c[d].NonDirectional.slice(0,3)===a||c[d].NonDirectional.slice(3,6)===a)&&b.push(c[d]);return b},greatCircle:function(a){return gcDistance(a)},generateAirports:function(){return getUniqueAirports()},allRoutes:function(){var a=fleetModel.getData("cityPairs"),b=fleetModel.getData("airports"),c=fleetModel.getData("flights"),d=[],e=[];if("undefined"==typeof a)return console.log("cityPairs not defined"),void 0;if("undefined"==typeof b)return console.log("Airports not defined"),void 0;for(var f=0;f<c.length;f++)d.push(c[f].NonDirectional);for(var g=_.uniq(d),h=0;h<g.length;h++)e[h]={NonDirectional:g[h],Fare:_.findWhere(a,{NonDirectional:g[h]}).Fare,Olat:_.findWhere(b,{Code:g[h].slice(0,3)}).Latitude,Oiata:g[h].slice(0,3),Diata:g[h].slice(3,6),Olon:_.findWhere(b,{Code:g[h].slice(0,3)}).Longitude,Ocity:_.findWhere(b,{Code:g[h].slice(0,3)}).City,Oname:_.findWhere(b,{Code:g[h].slice(0,3)}).Name,Ostate:_.findWhere(b,{Code:g[h].slice(0,3)}).State,Ocountry:_.findWhere(b,{Code:g[h].slice(0,3)}).Country,Dlat:_.findWhere(b,{Code:g[h].slice(3,6)}).Latitude,Dlon:_.findWhere(b,{Code:g[h].slice(3,6)}).Longitude,Dcity:_.findWhere(b,{Code:g[h].slice(3,6)}).City,Dname:_.findWhere(b,{Code:g[h].slice(3,6)}).Name,Dstate:_.findWhere(b,{Code:g[h].slice(3,6)}).State,Dcountry:_.findWhere(b,{Code:g[h].slice(3,6)}).Country,Distance:gcDistance(g[h]),Duration:_.findWhere(a,{NonDirectional:g[h]}).Duration,LF:_.findWhere(a,{NonDirectional:g[h]}).LF};return e},buildRoutes:function(){var a=fleetModel.getData("cityPairs"),b=fleetModel.getData("airports"),c=fleetModel.getData("flights"),d=navService.equipment,e=[],f=[];if("undefined"==typeof a)return console.log("cityPairs not defined"),void 0;if("undefined"==typeof b)return console.log("Airports not defined"),void 0;var g=_.pluck(_.where(d,{active:!0}),"code");if(g.length){for(var h=this.findArray(c,g,"Equipment"),i=0;i<h.length;i++)e.push(h[i].NonDirectional);for(var j=_.uniq(e),k=0;k<j.length;k++)f[k]={NonDirectional:j[k],Fare:_.findWhere(a,{NonDirectional:j[k]}).Fare,Olat:_.findWhere(b,{Code:j[k].slice(0,3)}).Latitude,Olon:_.findWhere(b,{Code:j[k].slice(0,3)}).Longitude,Ocity:_.findWhere(b,{Code:j[k].slice(0,3)}).City,Oname:_.findWhere(b,{Code:j[k].slice(0,3)}).Name,Ostate:_.findWhere(b,{Code:j[k].slice(0,3)}).State,Ocountry:_.findWhere(b,{Code:j[k].slice(0,3)}).Country,Dlat:_.findWhere(b,{Code:j[k].slice(3,6)}).Latitude,Dlon:_.findWhere(b,{Code:j[k].slice(3,6)}).Longitude,Dcity:_.findWhere(b,{Code:j[k].slice(3,6)}).City,Dname:_.findWhere(b,{Code:j[k].slice(3,6)}).Name,Dstate:_.findWhere(b,{Code:j[k].slice(3,6)}).State,Dcountry:_.findWhere(b,{Code:j[k].slice(3,6)}).Country,Distance:gcDistance(j[k]),Duration:_.findWhere(a,{NonDirectional:j[k]}).Duration,LF:_.findWhere(a,{NonDirectional:j[k]}).LF}}return routeReport=f,f}}}]),angular.module("appliedByDesignApp").factory("financialReports",["navService",function(navService){function runNpvReport(a,b,c){for(var d=_.pluck(_.where(c[0].data,{isCurrency:!0}),"name"),e=[],f=0;f<d.length;f++){e[f]={},e[f]={name:d[f],val:0,isExpense:"Revenue"===d[f]?!1:!0,decimals:_.findWhere(c[0].data,{name:d[f]}).decimals};for(var g=0;b>g;g++)e[f].val=e[f].val+_.findWhere(c[g].data,{name:d[f]}).val/Math.pow(1+a,g+1)}return e}function mapSum(a,b){return a+b}function findArray(inputArray,searchCrit,key){for(var critReturn=[],outputArray=[],crit=0;crit<searchCrit.length;crit++)if(critReturn=eval("_.where(inputArray,{"+key+':"'+searchCrit[crit]+'"})'),0===crit)outputArray=critReturn;else for(var j in critReturn)outputArray.push(critReturn[j]);return outputArray}var reports={};reports.base=[],reports.active=[],reports.npv=[];var flightFinancials={};flightFinancials.base=[],flightFinancials.active=[];var metrics={};return metrics.base=[],metrics.active=[],reports.getReport=function(a){return a?reports[a]:(console.log('!!! - no report type entered - specify "base" or "active"'),void 0)},reports.getMetricData=function(){var a=navService.activeYear;navService.activeMetricName;var b=navService.activeFleetModel,c=reports.base[a].perFlight[b].metrics,d=reports.active[a].perFlight[b].metrics,e={};return e.finance=[],e.ops=[],c.forEach(function(a,b){var c=_.max(reports.base[0].perFlight,function(a){return a.metrics[b].val}),f=_.min(reports.base[0].perFlight,function(a){return a.metrics[b].val}),g=_.reduce(reports.base[0].perFlight,function(a,c){return c.metrics[b].val+a},0),h=g/reports.base[0].perFlight.length,i=a.val,j=d[b].val,k={ranges:[f.metrics[b].val,c.metrics[b].val],measures:[i,j],markers:[h]};a.isCurrency?e.finance.push(k):e.ops.push(k)}),e},reports.getDeltaMetrics=function(){for(var a=this.getFlightMetrics("active"),b=this.getFlightMetrics("base"),c=[],d=0;d<a.length;d++){var e=a[d].val-b[d].val,f={name:a[d].name,val:e,isCurrency:a[d].isCurrency,isExpense:a[d].isExpense,decimals:a[d].decimals};c.push(f)}return console.log("calculated new metrics"),c},reports.getFlightMetrics=function(a){if(!a||!reports[a])return console.log("!!! - whoops - invalid report type entered as argument"),void 0;if(0===reports[a].length)return console.log("---reports not created yet - please try again later---"),void 0;var b=navService.activeYear;navService.activeMetricName;var c=navService.activeFleetModel;return reports[a][b].perFlight[c].metrics},reports.getRouteReport=function(a){return a?this.filterFinancialReport("active",a):(console.log("!!! - need to enter a routeName"),void 0)},reports.getYears=function(){return _.pluck(reports.base,"year")},reports.getNpv=function(a,b){for(var c=runNpvReport(a,b,reports.active),d=runNpvReport(a,b,reports.base),e=[],f=0;f<c.length;f++)e[f]={},e[f]={name:c[f].name,val:c[f].val-d[f].val,decimals:c[f].decimals};return reports.npv=e,_.reduce(e,function(a,b){return a+b.val},0)},reports.runReport=function(a){a||console.log("!!! - need to enter a report type"),console.log("2.1 go filterFinancialReport ["+a+"]"),reports[a]=this.filterFinancialReport(a),console.log("2.2 Saved a new report ["+a+"]")},reports.getMetricTotal=function(){return console.log("*() - Need to Hook up getMetricTotal()"),11111111},reports.setReport=function(a,b){return a&&b?(reports[a]=b,void 0):(console.log("!!! - need to enter a report type and report object"),void 0)},reports.setFlightFinancials=function(a,b){return a&&b?(flightFinancials[a]=b,console.log("1. Set Flight Financials["+a+"]"),void 0):(console.log("*** Need to enter more arguments!"),void 0)},reports.getRevenueForecast=function(a){if(!a||!reports[a])return console.log("invalid report type entered as argument"),void 0;var b=!0,c=[];return b&&reports[a].forEach(function(a){var b=a.Revenue.data[navService.activeFleetModel];b.year=a.year,c.push(b)}),c},reports.getRevenueForecastData=function(){var a=reports.getRevenueForecast("base"),b=reports.getRevenueForecast("active"),c=[];return b.forEach(function(b,d){c.push({year:b.year,base:a[d].val,active:b.val-a[d].val})}),c},reports.filterFinancialReport=function(a,b){if("base"!==a&&"active"!==a)return console.log("!WHoops! - need to pass in ACTIVE or BASE flag"),void 0;for(var c,d,e,f=flightFinancials[a],g=[],h={},i=["ASK","Crew","Freq","Fuel","Maintenance","Other","Ownership","PAX","RPM","Revenue","Seats"],j=[!1,!0,!1,!0,!0,!0,!0,!1,!1,!0,!1],k=[0,0,0,0,0,0,0,0,0,0,0],l=navService.equipment,m=_.pluck(_.where(l,{active:!0}),"code"),n=0;n<f.length;n++){if(e=findArray(f[n].fleetReport,m,"Equipment"),b){c=_.where(e,{NonDirectional:b}),h.detail={},h.detail.origin={City:c[0].oCity,Country:c[0].oCountry,State:c[0].oState,Name:c[0].oName,IATA:c[0].oIata},h.detail.destination={City:c[0].dCity,Country:c[0].dCountry,State:c[0].dState,Name:c[0].dName,IATA:c[0].dIata};var o=_.reduceRight(_.pluck(c,"monday"),mapSum,0),p=_.reduceRight(_.pluck(c,"tuesday"),mapSum,0),q=_.reduceRight(_.pluck(c,"wednesday"),mapSum,0),r=_.reduceRight(_.pluck(c,"thursday"),mapSum,0),s=_.reduceRight(_.pluck(c,"friday"),mapSum,0),t=_.reduceRight(_.pluck(c,"saturday"),mapSum,0),u=_.reduceRight(_.pluck(c,"sunday"),mapSum,0);h.detail.route={},h.detail.route.freq={},h.detail.route.freq.total=o+p+q+r+s+t+u,h.detail.route.freq.days=[o,p,q,r,s,t,u],h.detail.route.distance=c[0].Distance}else c=e,h.detail={};d=_.uniq(_.pluck(c,"Equipment")),h.year=_.uniq(_.pluck(f[n].fleetReport,"Year"))[0],h.data=[];for(var v=0,w=0,x=0;x<i.length;x++){c!==[]&&(v=_.reduceRight(_.pluck(c,i[x]),mapSum,0)),h.data[x]={name:i[x],val:v,isCurrency:j[x],isExpense:"Revenue"===i[x]?!1:!0,decimals:k[x]},h[i[x]]={},h[i[x]].data=[];for(var y=0;y<d.length;y++)c!==[]&&(w=_.reduceRight(_.pluck(_.where(c,{Equipment:d[y]}),i[x]),mapSum,0)),h[i[x]].data[y]={equipment:d[y],val:w},w=0;v=0}h.perFlight=[];for(var z=0;z<d.length;z++){h.perFlight[z]={},h.perFlight[z].equipment=d[z],h.perFlight[z].metrics=[];for(var A=0;A<i.length;A++){var B=_.reduceRight(_.pluck(_.where(c,{Equipment:d[z]}),i[A]),mapSum,0),C=_.reduceRight(_.pluck(_.where(c,{Equipment:d[z]}),"Freq"),mapSum,0);h.perFlight[z].metrics[A]={name:i[A],val:B/C,isCurrency:j[A],isExpense:"Revenue"===i[A]?!1:!0,decimals:k[A]}}}g.push(h),h={}}return g},reports}]),angular.module("appliedByDesignApp").factory("routeService",["financialReports",function(a){var b={};return b.routes=[],b.activeRoute=[],b.activeRouteName="ORDSEA",b.frequencies=[{name:"MON",active:!1,numFlights:4},{name:"TUE",active:!1,numFlights:2},{name:"WED",active:!1,numFlights:8},{name:"THU",active:!1,numFlights:0},{name:"FRI",active:!1,numFlights:3},{name:"SAT",active:!1,numFlights:0},{name:"SUN",active:!1,numFlights:10}],b.setActiveDay=function(a){return b.frequencies.forEach(function(b,c){b.active=c===a?!0:!1}),b.frequencies},b.runRouteReport=function(){b.activeRoute=a.getRouteReport(b.activeRouteName),b.activeRoute[0].detail.route.freq.days.forEach(function(a,c){b.frequencies[c].numFlights=a})},b}]),angular.module("appliedByDesignApp").directive("dailyFlights",function(){return{restrict:"E",scope:{numFlights:"="},link:function(a,b){a.$watch("numFlights",function(a){b.children().remove();for(var c=0;a>c;c++)b.append('<div class="frequency-bar">&nbsp</div>')})}}}),angular.module("appliedByDesignApp").directive("routeMap",["reportBuilder","navService","routeService",function(a,b,c){var d=d3.custom.routeMap();return{template:'<div class="routemap"></div>',replace:!0,restrict:"E",scope:{hovered:"&hovered"},link:function(e,f){var g=d3.select(f[0]);d.on("routeSelect",function(d){b.selectPanelTab(1);var f=a.getRouteNameFromId(d);c.activeRouteName=f,c.runRouteReport(),e.$apply()}),e.$watch(function(){return a.getReport("routeReport")},function(a){d.removeRoutes(),g.datum(a).call(d)})}}}]),angular.module("appliedByDesignApp").controller("ReportsPanelCtrl",["$scope","navService","financialReports","reportBuilder",function(a,b,c,d){a.ikons=["mobile","wrench","cog-2","stats"],a.fleetModel=function(){return b.equipment[b.activeFleetModel]},a.$watch(function(){return b.equipment},function(){a.deltaMetrics=c.getDeltaMetrics(),a.metricChartData=c.getMetricData().finance},!0),a.$watch(function(){return b.activeFleetModel},function(){a.deltaMetrics=c.getDeltaMetrics(),a.metricChartData=c.getMetricData().finance},!0),a.toggleService=function(a){b.toggleFleetService(a)[0],d.buildFinancialReport(!0,!0)},a.deltaMetric=function(b){return _.findWhere(a.deltaMetrics,{name:b}).val},a.metricsBase=function(){return c.getFlightMetrics("base")},a.metricsActive=function(){return c.getFlightMetrics("active")},a.incrementRate=function(b){a.rate+=b},a.changeDuration=function(b){a.years=b},a.prevModel=function(){var a=b.activeFleetModel-=1;0>a&&(a=b.equipment.length-1),b.activeFleetModel=a},a.nextModel=function(){var a=b.activeFleetModel+=1;a>b.equipment.length-1&&(a=0),b.activeFleetModel=a},a.years=5,a.rate=.08,a.npvTotal=function(){return c.getNpv(a.rate,a.years)},a.$watch(function(){return c.getReport("active")},function(){a.revenueForecast=c.getRevenueForecastData()},!0),a.operatingProfit=function(a){var b="delta"===a?c.getDeltaMetrics():c.getFlightMetrics("base");return _.reduce(b,function(a,b){var c=b.isExpense?-1:1;return b.isCurrency?a+b.val*c:a},0)}}]),angular.module("appliedByDesignApp").directive("donutChart",function(){return{template:'<div class="chart"></div>',replace:!0,restrict:"E",scope:{data:"=",hovered:"&hovered"},link:function(a,b){var c,d,e,f,g,h,i={top:20,right:50,bottom:20,left:40},j=250,k=220,l=500,m=j-i.left-i.right,n=k-i.top-i.bottom,o=Math.min(m,n)/2;c=d3.select(b[0]).append("svg").attr("width",j).attr("height",k),e=c.append("g").attr({transform:"translate("+m/2+","+125+")"}),d=d3.svg.arc().innerRadius(o-40).outerRadius(o-10),f=d3.layout.pie().value(function(a){return a.val}).sort(null),g=d3.scale.category20(),h=c.append("g").classed("labels",!0).attr({transform:"translate("+(j-100)+","+60+")"}),a.$watch("data",function(a){function b(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return d(b(a))}}if(a){var i=f(a),j=e.selectAll("path").data(i);j.enter().append("path").attr("d",d).attr("fill",function(a,b){return g(b)}).each(function(a){this._current=a}),j.transition().duration(l).attrTween("d",b).style("fill",function(a,b){return g(b)}),j.exit().remove(),h.selectAll("g").remove(),h.selectAll("g").data(i).enter().append("g").each(function(a,b){var c=d3.select(this);c.append("rect").attr("x",50).attr("y",25*b).attr("width",10).attr("height",12).style("fill",function(){return g(b)}),c.append("text").attr("x",65).attr("y",25*b+12).attr("height",30).attr("width",100).style("fill",function(){return g(b)}).text(function(a){return a.data.equipment})})}else c.selectAll("path").remove(),h.selectAll("line").remove(),h.selectAll("text.value").remove(),h.selectAll("text.units").remove()})}}}),angular.module("appliedByDesignApp").directive("barChart",function(){return{template:'<div class="chart"></div>',replace:!0,restrict:"E",scope:{data:"="},link:function(a){var b={top:10,right:10,bottom:10,left:10},c=a.width||300,d=a.height||1020;c=c-b.left-b.right,d=d-b.top-b.bottom,a.$watch("data",function(a){console.log("---new data for chart--- why is this running?"),a||console.log("no data! - why is this running?")})}}}),angular.module("appliedByDesignApp").directive("stackedChart",function(){return{template:'<div class="chart"></div>',replace:!0,restrict:"E",scope:{data:"="},link:function(a,b){var c=300,d=200,e=[20,50,30,20],f=d3.scale.ordinal().rangeRoundBands([0,c-e[1]-e[3]],.2),g=d3.scale.linear().range([0,d-e[0]-e[2]]),h=d3.scale.ordinal().range([d3.rgb(200,200,200),d3.rgb(48,128,178)]),i=d3.select(b[0]).append("svg:svg").attr("width",c).attr("height",d).append("svg:g").attr("transform","translate("+e[3]+","+(d-e[2])+")");a.$watch("data",function(a){var b=d3.layout.stack()(["base","active"].map(function(b){return a.map(function(a){return{x:a.year,y:a[b]}})}));f.domain(b[0].map(function(a){return a.x})),g.domain([0,d3.max(b[b.length-1],function(a){return a.y0+a.y})]);var c=i.selectAll("g.year").data(b).enter().append("svg:g").attr("class","year").style("fill",function(a,b){return h(b)});c.selectAll("rect").data(Object).enter().append("svg:rect").attr("x",function(a){return f(a.x)}).attr("y",function(a){return-g(a.y0)-g(a.y)}).attr("height",function(a){return g(a.y)}).attr("width",f.rangeBand()),c.selectAll("text.label").data(Object),enter().append("text").text("hello")})}}}),angular.module("appliedByDesignApp").directive("bulletChart",function(){function a(){d3.select("bullet-chart").selectAll("svg").remove()}var b={top:0,right:40,bottom:20,left:20},c=530-b.left-b.right,d=40-b.top-b.bottom,e=d3.bullet().width(c).height(d);return{restrict:"E",scope:{data:"="},link:function(f,g){var h;f.$watch("data",function(f){console.log("OK - new data in bullet refresh"),a(),h=d3.select(g[0]).selectAll("svg"),h.data(f).enter().append("svg").attr("class","bullet").attr("width",c+b.left+b.right).attr("height",d+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")").call(e);var i=h.append("g").style("text-anchor","end").attr("transform","translate(-6,"+d/2+")");i.append("text").attr("class","title").text(function(a){return a.title}),i.append("text").attr("class","subtitle").attr("dy","1em").text(function(a){return a.subtitle})})}}});